package de.dis2012.core;

import java.io.File;
import java.io.FileWriter;
import java.io.IOException;

public class PersistanceManager {
	
	static final private PersistanceManager persistancemanager;
	private int transactionId = 0;
	
	public int getTransactionId() {
		return transactionId;
	}
	
	public void setTransactionId(int transactionId) {
		this.transactionId = transactionId;
	}
	
	static {
		try {
			persistancemanager = new PersistanceManager();
		}catch (Throwable e) {
			throw new RuntimeException(e.getMessage());
		}
	}
	
	private PersistanceManager() {}
	
	static public PersistanceManager getInstance() {
		return persistancemanager;
	}
	
	public int beginTransaction() {
		setTransactionId(getTransactionId()+1);
		System.out.println("begin Transaction" + "\n" + "	with TransactionId: " + this.getTransactionId());
		return this.transactionId;
	}

	
	public void commit(int transactionId) {
		System.out.println("commit Thread with TransactionId: " + this.getTransactionId());
	}
	
	public void update() {
		
	}
	
	public void delete() {
		
	}
	
	public void write(int taid, int tpageid, String data) {
		File f = new File(tpageid + ".txt");
		
		try{
			if(!f.exists()) {
				FileWriter fw = new FileWriter(tpageid + ".txt");
				fw.write(taid + "\n" + tpageid + "\n" + data );
				fw.flush();
				fw.close();
			} else {
				f.delete();
			}
		
		} catch(IOException e) {
			
		}
	}
}
